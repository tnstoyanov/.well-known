<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Pay Nuvei</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 40px;
            background-color: #f5f5f7;
            color: #1d1d1f;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .apple-pay-logo {
            background: linear-gradient(135deg, #000 0%, #333 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .content {
            text-align: center;
            margin-top: 40px;
        }

        p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #6e6e73;
            margin-bottom: 20px;
        }

        /* Apple Pay Button Styles */
        @supports (-webkit-appearance: -apple-pay-button) {
            .apple-pay-button-with-text {
                display: inline-block;
                -webkit-appearance: -apple-pay-button;
                appearance: -apple-pay-button;
                -apple-pay-button-type: top-up;
                width: 200px;
                height: 44px;
                border-radius: 4px;
                margin: 20px 0;
            }
            .apple-pay-button-with-text > * {
                display: none;
            }
            .apple-pay-button-black-with-text {
                -apple-pay-button-style: black;
            }
        }

        @supports not (-webkit-appearance: -apple-pay-button) {
            .apple-pay-button-with-text {
                display: inline-flex;
                justify-content: center;
                align-items: center;
                font-size: 16px;
                border-radius: 5px;
                width: 200px;
                height: 44px;
                cursor: pointer;
                margin: 20px 0;
                background-color: black;
                color: white;
            }
            .apple-pay-button-with-text > .text {
                font-family: -apple-system;
                font-size: 18px;
                font-weight: 300;
                margin-right: 6px;
            }
            .apple-pay-button-with-text > .logo {
                width: 48px;
                height: 100%;
                background-size: 100% 60%;
                background-repeat: no-repeat;
                background-position: 0 50%;
                border: none;
            }
        }

        .apple-pay-button-with-text:hover {
            opacity: 0.8;
        }

        .apple-pay-button-with-text:active {
            opacity: 0.6;
        }

        .apple-pay-button-fallback {
            background-color: #000;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: none;
            width: 450px;
            height: 100px;
        }

        .apple-pay-section {
            margin-top: 40px;
            text-align: center;
        }
        .tiebreak-logo {
            display: block;
            margin: 0 auto 24px auto;
            max-width: 180px;
        }
    </style>
    <script type="text/javascript"
        src="https://cdn.safecharge.com/safecharge_resources/v1/sc_api_applepay.min.js"></script>
    
    <script>
        // Check Apple Pay availability and show appropriate button
        function checkApplePayAvailability() {
            if (window.ApplePaySession && ApplePaySession.canMakePayments()) {
                // Apple Pay is available
                document.getElementById('apple-pay-button').style.display = 'inline-block';
                document.getElementById('apple-pay-fallback').style.display = 'none';
            } else {
                // Apple Pay not available, show fallback
                document.getElementById('apple-pay-button').style.display = 'none';
                document.getElementById('apple-pay-fallback').style.display = 'inline-flex';
            }
        }

        // Initialize Apple Pay session
        function initiateApplePay() {
            if (!window.ApplePaySession) {
                alert('Apple Pay is not supported on this device/browser');
                return;
            }

            // Apple Pay payment request configuration
            const paymentRequest = {
                countryCode: 'US',
                currencyCode: 'USD',
                supportedNetworks: ['visa', 'masterCard', 'amex', 'discover'],
                merchantCapabilities: ['supports3DS'],
                total: {
                    label: 'Top Up Amount',
                    amount: '25.00' // Default top-up amount
                }
            };

            // Create Apple Pay session
            const session = new ApplePaySession(3, paymentRequest);

            // Handle merchant validation
            session.onvalidatemerchant = function(event) {
                console.log('Merchant validation required');
                // This would typically make a call to your server to validate the merchant
                // For demo purposes, we'll just log it
            };

            // Handle payment authorization
            session.onpaymentauthorized = function(event) {
                console.log('Payment authorized:', event.payment);
                
                // Here you would process the payment with Nuvei
                // For demo purposes, we'll simulate success
                session.completePayment(ApplePaySession.STATUS_SUCCESS);
                
                alert('Top Up successful! (Demo)');
            };

            // Handle cancellation
            session.oncancel = function(event) {
                console.log('Payment cancelled');
            };

            // Begin the session
            session.begin();
        }

        // Check availability when page loads
        document.addEventListener('DOMContentLoaded', checkApplePayAvailability);
    </script>
</head>

<body>
    <div class="container">
        <img src="img/tiebreakLogo.png" alt="Tiebreak Logo" class="tiebreak-logo" />

        <h1><span class="apple-pay-logo">Apple Pay</span> Nuvei Demo</h1>

        <div class="content">            
            <div class="apple-pay-section">
                <h2>Top Up Your Account</h2>
                <p>Use Apple Pay to quickly and securely add funds to your account.</p>
                
                <div id="apple-pay-button" class="apple-pay-button-with-text apple-pay-button-black-with-text" onclick="initiateApplePay()">
                    <span class="text">Top Up with</span>
                    <span class="logo"></span>
                </div>
                
                <!-- Fallback message for non-Safari browsers -->
                <div id="apple-pay-fallback" class="apple-pay-button-fallback" style="display: none; align-items: center; justify-content: center; text-align: center;">
                    You need a Safari browser to run Apple Pay. Please close this one and open the URL in your Safari browser.
                </div>
            </div>
        </div>
        
    </div>

</body>

</html>